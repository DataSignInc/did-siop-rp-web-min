<!DOCTYPE html>
<html>
<head>
    <title>Index</title>
</head>
<body>
    <h1>Index Page</h1>
    <button id="did-siop-login" data-did-siop="pre-generated-request">DID SIOP Login</button>
    <button id="did-siop-login-err" onclick="loginWithError()">DID SIOP Login with error</button>    
    <script src="https://cdn.jsdelivr.net/npm/did-siop@1.3.0/dist/browser/did-siop.min.js"></script>
    <script>
    
        document.addEventListener('DOMContentLoaded', async function() {
            await startProcess();
            }, false);    

        let siop_rp = null;

        async function startProcess(){
            console.log('startProcess');
    
            siop_rp = await DID_SIOP.RP.getRP(
                'localhost:5001/home', // RP's redirect_uri
                'did:ethr:0xA51E8281c201cd6Ed488C3701882A44B1871DAd6', // RP's did
                {
                    "jwks_uri": "https://uniresolver.io/1.0/identifiers/did:example:0xab;transform-keys=jwks",
                    "id_token_signed_response_alg": ["ES256K-R", "EdDSA", "RS256"]
                }
            )
            console.log('Got RP instance ....');
            siop_rp.addSigningParams(
                '8329a21d9ce86fa08e75354469fb8d78834f126415d5b00eef55c2f587f3abca', // Private key
                'did:ethr:0xA51E8281c201cd6Ed488C3701882A44B1871DAd6#owner', // Corresponding authentication method in RP's did document (to be used as kid value for key)
                DID_SIOP.KEY_FORMATS.HEX, //Format in which the key is supplied. List of values is given below
                DID_SIOP.ALGORITHMS['ES256K-R']
            );

            let request = await siop_rp.generateRequest();
            let url = new URL(request);
            console.log('url', url);

            document.getElementById("did-siop-login").setAttribute("data-did-siop", url);

        }
    
        // async function setRequest(){
        //     await startProcess();            
        //     let request = await siop_rp.generateRequest();
        //     let url = new URL(request);
        //     console.log('url', url);

        //     let btn = document.getElementById('did-siop-login');
        //     document.getElementById("did-siop-login").setAttribute("data-did-siop", url);

        // }

        async function loginWithError(){
            let request = 'openid://?response_type=id_token&client_id=localhost:8080/home.html&scope=openid did_authn&request=';
            let url = new URL(request);
            window.open(url);
        }
    </script>
</body>
</html>
